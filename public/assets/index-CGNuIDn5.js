var y=Object.defineProperty;var f=(o,t,e)=>t in o?y(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var a=(o,t,e)=>(f(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class l{static async getTasks(){return await(await fetch(this.baseUrl+"/tasks")).json()}static async postTask(t){return console.log(t),await(await fetch(this.baseUrl+"/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}static async deleteTaskById(t){return await(await fetch(this.baseUrl+"/tasks/"+t,{method:"DELETE"})).json()}static async getCategories(){return await(await fetch(this.baseUrl+"/categories")).json()}}a(l,"baseUrl","http://localhost:3000");class u{constructor(t){a(this,"id");a(this,"title");a(this,"description");a(this,"end");a(this,"priority");a(this,"categorieIds");this.id=t.id,this.title=t.title,this.description=t.description,this.end=t.end,this.priority=t.priority,this.categorieIds=[]}getHTMLFragment(){const t=document.createElement("div");t.classList.add("task",this.priority);const e=document.createElement("h3"),n={high:"Haute",medium:"Moyenne",low:"Basse"};e.textContent=this.title;const s=document.createElement("span");if(s.textContent=`- Priorité ${n[this.priority]}`,e.appendChild(s),t.appendChild(e),this.end){const d=document.createElement("p");d.textContent=`Date d'échéance: ${this.end}`,t.appendChild(d)}if(this.description){const d=document.createElement("p");d.textContent=this.description,t.appendChild(d)}const i=document.createElement("button");i.type="button",i.textContent="Supprimer",i.addEventListener("click",()=>{c.removeTask(this)}),t.appendChild(i);const r=document.createElement("button");return r.classList.add("edit-btn"),r.textContent="Modifier",t.appendChild(r),t}}class m{constructor(){a(this,"_tasks",[]);a(this,"taskContainer");a(this,"_displayConditions",[null,null,null]);this.taskContainer=document.querySelector("#tasks > #tasks")}set tasks(t){this._tasks=t,this.displayTasks()}get tasks(){return this._tasks}set displayConditions(t){this._displayConditions=t,console.log("update condfiitog"),this.displayTasks()}get displayConditions(){return this._displayConditions}async getTasks(){if(this._tasks.length)return this._tasks;try{for(const t of await l.getTasks())this.tasks=[...this._tasks,new u(t)];return this._tasks}catch(t){return console.log(t),[]}}async postTask(t){try{const e=await l.postTask(t);return this.tasks=[...this.tasks,new u(e)],!0}catch(e){return console.log(e),!1}}async removeTask(t){try{l.deleteTaskById(t.id);const e=this._tasks.findIndex(n=>n.id===t.id);if(e===-1)return;this.tasks=this.tasks.filter((n,s)=>s!==e)}catch(e){console.log(e)}}displayTasks(){for(;this.taskContainer.firstChild;)this.taskContainer.firstChild.remove();const[t,e,n]=this.displayConditions,s=this.tasks.filter(i=>(t?t(i):!0)&&(e?e(i):!0)&&(n?n(i):!0));for(const i of s)this.taskContainer.appendChild(i.getHTMLFragment())}search(t){this.displayConditions[0]=t,this.displayTasks()}setPriorityCondition(t){t==="all"?this.displayConditions[1]=()=>!0:this.displayConditions[1]=e=>e.priority===t,this.displayTasks()}setDueCondition(t){if(t==="")this.displayConditions[2]=null;else{const e=String(t.getFullYear()).padStart(4,"0")+"-"+String(t.getDate()).padStart(2,"0")+"-"+String(t.getMonth()+1).padStart(2,"0");this.displayConditions[2]=n=>n.end===e}this.displayTasks()}}const c=new m;c.getTasks();const p=document.querySelector("#taskForm"),k=document.querySelector("#searchInput"),h=document.querySelector("#filterForm");p.addEventListener("submit",async o=>{o.preventDefault();const t=new FormData(p),e={title:t.get("taskTitle"),description:t.get("taskTitle")??null,end:t.get("taskDueDate")??null,priority:t.get("taskPriority")};await c.postTask(e)&&p.reset()});k.addEventListener("input",o=>{const e=o.target.value;c.search(e?n=>n.title.includes(e)||(n.description?n.description.includes(e):!1):null)});h.addEventListener("submit",o=>{o.preventDefault();const t=new FormData(h);c.setPriorityCondition(t.get("filterPriority"));const e=t.get("filterDate");c.setDueCondition(e===""?"":new Date(e)),c.displayTasks()});
