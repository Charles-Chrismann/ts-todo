var M=Object.defineProperty;var B=(r,e,t)=>e in r?M(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(B(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class p{static async getTasks(){return await(await fetch(this.baseUrl+"/tasks")).json()}static async postTask(e){return console.log(e),await(await fetch(this.baseUrl+"/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}static async deleteTaskById(e){return await(await fetch(this.baseUrl+"/tasks/"+e,{method:"DELETE"})).json()}static async updateTaskById(e,t){return await(await fetch(this.baseUrl+"/tasks/"+e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json()}static async getCategories(){return await(await fetch(this.baseUrl+"/categories")).json()}static async postCategory(e){return await(await fetch(this.baseUrl+"/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})})).json()}}a(p,"baseUrl","http://localhost:3000");class D{}class I extends D{constructor(t){super();a(this,"id");a(this,"title");a(this,"description");a(this,"end");a(this,"priority");a(this,"categoriesId");this.id=t.id,this.title=t.title,this.description=t.description,this.end=t.end,this.priority=t.priority,this.categoriesId=t.categoriesId??[]}getHTMLFragment(){const t=document.createElement("div");t.classList.add("task",this.priority);const n=document.createElement("h3"),s={high:"Haute",medium:"Moyenne",low:"Basse"};n.textContent=this.title;const i=document.createElement("span");i.textContent=`- Priorité ${s[this.priority]}`,n.appendChild(i),t.appendChild(n);const o=document.createElement("p");this.end&&(o.textContent=`Date d'échéance: ${this.end}`,t.appendChild(o));const d=document.createElement("p");this.description&&(d.textContent=this.description,t.appendChild(d));const l=document.createElement("button");l.type="button",l.textContent="Supprimer",l.addEventListener("click",()=>{c.removeTask(this)}),t.appendChild(l);const u=document.createElement("button");u.classList.add("edit-btn"),u.textContent="Modifier";const k=document.createElement("div"),v=document.createElement("input");v.value=this.title,k.appendChild(v);const h=document.createElement("select"),T=document.createElement("option");T.textContent="Faible",T.value="low";const E=document.createElement("option");E.textContent="Moyenne",E.value="medium";const w=document.createElement("option");w.textContent="Forte",w.value="high",h.appendChild(T),h.appendChild(E),h.appendChild(w),h.value=this.priority,k.appendChild(h);const g=document.createElement("input");g.type="date",g.value=this.end??"";const L=document.createElement("p");L.textContent="Date d'échéance: ",L.appendChild(g);const y=document.createElement("textarea");y.style.width="50%",y.value=this.description??"";const m=document.createElement("button");m.classList.add("edit-btn"),m.textContent="Valider",m.addEventListener("click",()=>{c.updateTask(this,{title:v.value,priority:h.value,end:g.value,description:y.value})});const C=document.createElement("button");C.type="button",C.textContent="Annuler",C.addEventListener("click",()=>{c.displayTasks()}),u.addEventListener("click",()=>{for(;t.firstChild;)t.firstChild.remove();t.appendChild(k),t.appendChild(L),t.appendChild(y),t.appendChild(m),t.appendChild(C)}),t.appendChild(u);const f=document.createElement("div");f.classList.add("categoryContainer");const S=document.createElement("ul");S.classList.add("categories"),f.appendChild(S);for(const F of this.categoriesId){const _=c.categories.find(q=>q.id===F);S.appendChild(_.getHTMLFragment())}const b=document.createElement("button");return b.textContent="+",b.addEventListener("click",()=>{c.openModal(this)}),f.appendChild(b),t.appendChild(f),t}}class x extends D{constructor(t){super();a(this,"id");a(this,"name");a(this,"color");this.id=t.id,this.name=t.name,this.color=this.getRandomColor()}getRandomColor(){for(var t="0123456789ABCDEF",n="#",s=0;s<6;s++)n+=t[Math.floor(Math.random()*16)];return n}getHTMLFragment(){const t=document.createElement("li");return t.classList.add("category"),t.style.backgroundColor=this.color,t.textContent=this.name,t}}class P{constructor(){a(this,"_tasks",[]);a(this,"_categories",[]);a(this,"taskContainer",document.querySelector("#tasks > #tasks"));a(this,"categoryContainer",document.querySelector("#categories"));a(this,"_displayConditions",[null,null,null])}set tasks(e){this._tasks=e,this.displayTasks()}get tasks(){return this._tasks}set categories(e){this._categories=e,this.displayCategories()}get categories(){return this._categories}set displayConditions(e){this._displayConditions=e,this.displayTasks()}get displayConditions(){return this._displayConditions}async getTasks(){if(this._tasks.length)return this._tasks;try{for(const e of await p.getTasks())this.tasks=[...this._tasks,new I(e)];return this._tasks}catch(e){return console.log(e),[]}}async postTask(e){try{const t=await p.postTask(e);return this.tasks=[...this.tasks,new I(t)],!0}catch(t){return console.log(t),!1}}async removeTask(e){try{p.deleteTaskById(e.id);const t=this._tasks.findIndex(n=>n.id===e.id);if(t===-1)return;this.tasks=this.tasks.filter((n,s)=>s!==t)}catch(t){console.log(t)}}async updateTask(e,t){try{const n=await p.updateTaskById(e.id,t),s=this._tasks.findIndex(i=>i.id===e.id);this.tasks=[...this.tasks.slice(0,s),new I(n),...this.tasks.slice(s+1,this.tasks.length)]}catch(n){console.log(n)}}displayTasks(){for(;this.taskContainer.firstChild;)this.taskContainer.firstChild.remove();const[e,t,n]=this.displayConditions,s=this.tasks.filter(i=>(e?e(i):!0)&&(t?t(i):!0)&&(n?n(i):!0));for(const i of s)this.taskContainer.appendChild(i.getHTMLFragment())}displayCategories(){for(;this.categoryContainer.firstChild;)this.categoryContainer.firstChild.remove();for(const e of this.categories)this.categoryContainer.appendChild(e.getHTMLFragment())}search(e){this.displayConditions[0]=e,this.displayTasks()}setPriorityCondition(e){e==="all"?this.displayConditions[1]=()=>!0:this.displayConditions[1]=t=>t.priority===e,this.displayTasks()}setDueCondition(e){if(e==="")this.displayConditions[2]=null;else{const t=String(e.getFullYear()).padStart(4,"0")+"-"+String(e.getDate()).padStart(2,"0")+"-"+String(e.getMonth()+1).padStart(2,"0");this.displayConditions[2]=n=>n.end===t}this.displayTasks()}async getCategories(){try{if(this.categories.length)return this.categories;for(const e of await p.getCategories())this.categories=[...this.categories,new x(e)];return this._tasks}catch(e){console.log(e)}}async postCategory(e){try{if(this.categories.find(n=>n.name===e))return;const t=new x(await p.postCategory(e));this.categories=[...this.categories,t]}catch(t){console.log(t)}}openModal(e){var o;document.querySelector(".popup").classList.remove("hide");const t=[],n=this.categories.filter(d=>!e.categoriesId.includes(d.id)),s=document.querySelector(".card .categories");for(;s.firstChild;)(o=s.firstChild)==null||o.remove();document.querySelector(".popup button").remove();for(const d of n){const l=d.getHTMLFragment();l.addEventListener("click",()=>{l.classList.contains("toggled")?(t.splice(t.findIndex(u=>u===d.id),1),l.classList.remove("toggled")):(t.push(d.id),l.classList.add("toggled")),console.log(t)}),s.appendChild(l)}const i=document.createElement("button");i.textContent="Valider",i.addEventListener("click",()=>{this.addCategorieToTask(e,t),document.querySelector(".popup").classList.add("hide")}),document.querySelector(".card").appendChild(i)}async addCategorieToTask(e,t){e.categoriesId=e.categoriesId.concat(t),await p.updateTaskById(e.id,{categoriesId:e.categoriesId}),this.displayTasks()}}const c=new P;(async()=>{await c.getCategories(),await c.getTasks();const r=document.querySelector("#taskForm"),e=document.querySelector("#searchInput"),t=document.querySelector("#filterForm"),n=document.querySelector(".popup");r.addEventListener("submit",async s=>{s.preventDefault();const i=new FormData(r),o={title:i.get("taskTitle"),description:i.get("taskTitle")??null,end:i.get("taskDueDate")??null,priority:i.get("taskPriority")};await c.postTask(o)&&r.reset()}),e.addEventListener("input",s=>{const o=s.target.value;c.search(o?d=>d.title.includes(o)||(d.description?d.description.includes(o):!1):null)}),t.addEventListener("submit",s=>{s.preventDefault();const i=new FormData(t);c.setPriorityCondition(i.get("filterPriority"));const o=i.get("filterDate");c.setDueCondition(o===""?"":new Date(o)),c.displayTasks()}),document.querySelector("#create-category-btn").addEventListener("click",()=>{const s=document.querySelector("#category-name").value;c.postCategory(s)}),document.querySelector(".overlay").addEventListener("click",()=>{n.classList.add("hide")})})();
